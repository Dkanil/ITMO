# Глава 3.1. Паросочетания, независимые множества и покрытия

## Билет 1. Независимые множества, паросочетания и покрытия в графе. Теорема Галлаи.
1) Множество вершин $U\subset V(G)$ называется **независимым**, если никакие две его вершины не смежны.
> *Обозначение*: $\alpha(G)$  - **количество вершин** в **максимальном** независимом множестве графа $G$.

2) Множество рёбер $M \subset E(G)$ называется **паросочетанием**, если никакие два его ребра не имеют общей вершины.
> *Обозначение*: $\alpha'(G)$ - **количество рёбер** в **максимальном** паросочетании графа $G$.

3) Будем говорить, что множество вершин $W \subset V(G)$ **покрывает** ребро $e \in E(G)$, если существует вершина $w \in W$ , инцидентная $e$. 

4) Будем говорить, что множество рёбер $F \subset E(G)$ **покрывает** вершину $v \in V(G)$, если существует ребро $f \in F$, инцидентное $v$ .

5) Паросочетание $M$ графа $G$ называется совершенным, если оно покрывает все вершины графа.

6) Множество вершин $W \subset V(G)$ называется вершинным покрытием, если оно покрывает все рёбра графа.
> *Обозначение*: $\beta(G)$ **количество вершин** в **минимальном** вершинном покрытии графа $G$ .

7) Множество рёбер $F \subset E (G)$ называется рёберным покрытием, если оно покрывает все вершины графа.
> *Обозначение*: $\beta'(G)$ **количество рёбер** в **минимальном** рёберном покрытии графа $G$ .

### Лемма 1
1) $U \subset V (G)$ — независимое множество, если и только если $V (G)\setminus U$ — вершинное покрытие.
2) $\alpha(G) + \beta(G) = v(G)$. (Верно для любого графа).
> *Повторение*: $\alpha(G)$  - **количество вершин** в **максимальном** независимом множестве графа $G$.
>  *Повторение*: $\beta(G)$ **количество вершин** в **минимальном** вершинном покрытии графа $G$
#### Доказательство
$U \subset V (G)$ — максимальное независимое множество, если и только если $V (G)\setminus U$ — минимальное вершинное покрытие

### Теорема Галлаи
**(T. Gallai, 1959)** Пусть $G$ — граф с $\delta(G) > 0$. Тогда $\alpha'(G) + \beta'(G) = v(G)$
> *Повторение*: $\delta(G)$ - минимальная степень вершины графа $G$.
> *Повторение*: $\alpha'(G)$ - **количество рёбер** в **максимальном** паросочетании графа $G$.
> *Повторение*: $\beta'(G)$ **количество рёбер** в **минимальном** рёберном покрытии графа $G$ .
#### Доказательство (сначала $\leq$ потом $\geq$)
$\leq$
- Пусть $M$ — **максимальное паросочетание**, $U$ — множество **не покрытых** $M$ вершин графа, тогда $|U| = v (G) − 2\alpha'(G )$.
- Так как $\delta (G) > 0$, можно выбрать множество $F$ из $|U|$ рёбер, покрывающее $U$.
- Тогда $M \cup F$ — покрытие, следовательно, 
$\beta'(G) \leq |M \cup F | = \alpha'(G) + v(G) − 2\alpha'(G)$, откуда
$\alpha'(G) + \beta'(G) \leq v(G)$.

$\geq$
- Пусть $L$ — минимальное рёберное покрытие $(|L| = \beta'(G))$, а $H = (V(G), L)$.
> *Обьяснение*: $H = (V(G), L)$ - граф $H$ образован из вершин графа $G$ и ребёр покрытия $L$.
- Так как в графе $H$ нет вершин степени 0, в каждой компоненте графа $H$ можно выбрать по ребру, в результате получится паросочетание $N$ в графе $H$ (а значит, и в $G$).
- Следовательно, $\alpha'(G) ≥ |N| = c(H)$ и 
$\beta'(G ) = |L| = e(H) \geq v(H) − c(H) = v (G ) − c(H) \geq v (G ) − \alpha'(G )$, откуда следует $\alpha'(G) + \beta'(G) \geq v(G)$.
> *Повторение*: $c(H)$ - число компонент связности графа $H$
- Получаем, что $\alpha'(G) + \beta'(G) = v(G)$.


## Билет 2. Максимальное паросочетание и дополняющие пути: теорема Бержа.
Пусть $M$ — паросочетание в графе $G$.
1) Назовём путь $M$-***чередующимся***, если в нём чередуются рёбра из $M$ и рёбра, не входящие в $M$.
2) Назовём $M$-чередующийся путь $M$-***дополняющим***, если его начало и конец не покрыты паросочетанием $M$.
> *Уточнение:* в этот путь могут входить и не все рёбра из $M$

• В $M$-***дополняющем*** пути нечётное число рёбер, причем рёбер из паросочетания $M$ на одно меньше, чем рёбер, не входящих в $M$

 ### Теорема Бержа
**(C. Berge, 1957)** Паросочетание $M$ в графе $G$ является *максимальным* тогда и только тогда, когда нет $M$-***дополняющих*** путей.

#### Доказательство
$\Rightarrow$ 
- Пусть в графе $G$ существует $M$-**дополняющий путь** $S = a_1a_2 \ldots a_{2k}$ .
- Тогда **заменим** входящие в $M$ рёбра $a_2a_3,\ldots , a_{2k−2}a_{2k−1}$ на не входящие в $M$ рёбра $a_1a_2, a_3a_4,. . . , a_{2k−1}a_{2k}$, и тем самым получим **большее паросочетание**. Противоречие.

$\Leftarrow$
- Пусть $M$ — **не максимальное** паросочетание, тогда рассмотрим максимальное паросочетание $M'$, $|M'| > |M|$.
- Пусть $N = M \Delta M'$, $H = G (N)$. Для любой вершины $v \in V(H)$ мы имеем $d_H (v) \in \{1, 2\}$, следовательно, $H$ — объединение нескольких путей и циклов.
> *Объяснение:* $H$ — это подграф графа $G$, порождённый рёбрами из $N$
- В каждом из этих путей и циклов рёбра паросочетаний $M$ и $M'$ **чередуются**. Так как рёбер из $M'$ в $E(H)$ больше, хотя бы одна компонента $P$ графа $H$ — **путь нечётной длины**, в котором больше рёбер из $M'$. Легко понять, что $P$ — это **$M$-дополняющий** путь. Противоречие.
> *Объяснение*: $M \Delta M'$ - это симметрическая разность: $M\Delta M'=(M\setminus M')\cup (M'\setminus  M)$
![photo](https://github.com/Dkanil/ITMO/blob/main/semester1/DM/Symmetric%20difference.png?raw=true)

## Билет 3. Теорема Холла.
- Пусть $G = (V_1, V_2, E)$ — двудольный граф с долями $V_1$ и $V_2$.

**(P. Hall, 1935.)** В двудольном графе G есть паросочетание, покрывающее все вершины доли $V_1$, **если и только если** для **любого** множества $U \subset V_1$ выполняется $|U| \leq |N_G (U)|$.
>*Повторение*: $|N_G (U)|$ окрестность множества вершин $U$ — множество всех вершин графа $G$ , смежных с вершинами из $U$.
>*Повторение*: Граф называется **двудольным**, если его вершины можно
разбить на два множества (т.е. две доли), внутри которых **нет** рёбер.

• Условие о размере окрестности из теоремы Холла мы будем называть **условием Холла** для доли $V_1$.
#### Доказательство
$\Rightarrow$
Очевидно, так как концы рёбер паросочетания, покрывающих вершины из $U$ — **разные** вершины из $N_G(U)$.
$\Leftarrow$
Докажем **по индукции** по количеству вершин в графе: 
**База** для $|V_1| = 1$ очевидна. 
**Индукционный переход**: Предположим, что для меньшего чем $G$ графа утверждение уже доказано. 

*Разберём два случая.*
##### Cлучай 1: 
Существует такое непустое множество $A \subsetneq V_1$, что $|A| = |N_G(A)|$.
- Введём **обозначения** $B = N_G(A)$, $A' = V_1\setminus A$, $B' = V_2 \setminus B$. 
Пусть $G_1 = G (A \cup B)$, $G_2 = G (A' \cup B')$.
- Очевидно, для двудольного графа $G_1$ и его доли $A$ **выполняется условие Холла**. По индукционному предположению в графе $G_1$ существует паросочетание $M_1$, покрывающее $A$.
- Проверим **условие Холла** для двудольного графа $G_2$ и его доли $A'$. Рассмотрим $U \subset A'$. Тогда 
$|U| + |A| = |U \cup A| \leq |N_G (U \cup A)| = |N_{G_2} (U) \cup B| = |N_{G_2}(U)| + |B| = |N_{G_2}(U)| + |A|$, откуда следует $|U| ≤ |N_{G_2}(U)|$.
- Значит, в графе $G_2$ **существует** паросочетание $M_2$, покрывающее все вершины из $A'$. Тогда $M_1 \cup M_2$ — паросочетание в $G$ , покрывающее $V_1$.
##### Cлучай 2:
 Для любого непустого множества $A \subsetneq V_1$ выполняется $|A| < |N_G (A)|$.
- Рассмотрим произвольную вершину $a \in V_1$ и смежную с ней вершину $b \in V_2$.
- Пусть $G' = G\ −\ a\ −\ b$. 
- **Проверим условие Холла** для двудольного графа $G'$ и его доли $V_1 \setminus {a}$. 
- Для любого множества $A \subset V_1 \setminus \{a\}$ выполняется 
$|A| \leq |N_G(A)| − 1 \leq |N_G (A) \setminus \{b\}| = |N_{G'} (A)|$.
- Поэтому в графе $G'$ существует паросочетание, покрывающее $V_1 \setminus \{a\}$. Вместе с ребром $ab$ получаем искомое паросочетание.

## Билет 4. Следствия из теоремы Холла: паросочетания в двудольном графе, где степени одной доли больше чем другой, а также в регулярном двудольном графе.
### Следствие 1
В двудольном графе $G = (V_1, V_2, E)$ все вершины из $V_1$ имеют степени не меньше $k$, а все вершины $V_2$ имеют степени не больше $k$. Тогда есть паросочетание, покрывающее $V_1$.
#### Доказательство
- Проверим условие Холла для доли $V_1$.
Пусть $A \subset V_1(G)$, тогда из вершин $A$ выходит не менее чем $k \cdot |A|$ рёбер к вершинам из $N_G(A)$, а в каждую вершину $b \in N_G(A)$ входит не более, чем $k$ рёбер из вершин множества $A$.
- Таким образом, 
$k|A| \leq e_G (A, N_G(A)) \leq k|N_G(A)|$,
откуда $|A| \leq |N_G(A)|$
>*Обозначение*: $e_G (A, N_G(A))$ - количество рёбер, соединяющих вершины множества $A$ с вершинами множества $N_G(A)$

### Следствие 2
**(D. König, 1916.)** Пусть $G = (V_1, V_2, E)$ — регулярный двудольный граф степени $k$. Тогда $G$ есть объединение $k$ своих совершенных паросочетаний.
#### Доказательство
- По Следствию 1 в $G$ существует паросочетание $M$, покрывающее $V_1$.
- Так как степени всех вершин равны по $k$, а каждое ребро соединяет $V_1$ и $V_2$, мы имеем $k|V_1| = e(G) = k|V_2|$.
- Следовательно, $|V_1| = |V_2|$. Поэтому, паросочетание $M$ покрывает и долю $V_2$, то есть, $M$ — совершенное.
- $G − M$ — регулярный двудольный граф степени $k − 1$. Продолжая выделять совершенные паросочетания, мы разобьём граф $G$ на $k$ паросочетаний.

## Билет 5. Теорема о гареме.
В одной далекой стране проживают юноши $\{A_1, \dots , A_n\}$. 
Для каждого $i \in \{1, . . . , n\}$, юноша $A_i$ хочет завести гарем из $k_i$ знакомых ему девушек (естественно, $k_i \in \mathbb{N}$).
Они могут это одновременно сделать тогда и только тогда, когда для любого множества юношей количество знакомых хотя бы одному из них девушек не меньше, чем сумма желаемых ими размеров гаремов.
#### Доказательство
- Построим двудольный граф $G = (V_1, V_2, E)$.
- Вершины доли $V_1$ соответствуют юношам — каждому $A_i$ соответствует $k_i$ вершин $a_{i, 1}, \dots , a_{i,k_i}$ (назовем их копиями $A_i$).
- Вершины доли $V_2$ соответствуют девушкам. Каждая вершина $a_{i,j} \in V_1$ соединена в точности с теми девушками из $V_2$, с которыми знаком юноша $A_i$.
- Проверим, что для доли $V_1$ выполнено условие Холла.
- Пусть $M \subset V_1$, а $A_{i_1} , \dots , A_{i_m}$ — все юноши, чьи копии есть в $M$.
- Тогда $|N_G (M)| \geq k_{i_1} + \cdots + k_{i_m}$ (в $N_G(M)$ входят все девушки, знакомые с $A_{i_1} , \dots , A_{i_m}$).
- В то же время, $|M| \leq k_{i_1} + \cdots + k_{i_m}$ (в $M$ не может входить больше копий $A_{i_1} , \dots , A_{i_m}$ , чем их существует).
- Таким образом, в $G$ есть паросочетание, покрывающее $V_1$.
- Для каждого $A_i$ девушки, входящие в пары с его копиями, образуют гарем желаемого размера.

## Билет 6. Теорема Кёнига и ее следствие. 
### Теорема Кёнига
**(D. König, 1931.)** Пусть $G$ — двудольный граф. Тогда $\alpha'(G) = \beta(G)$
> *Повторение*: $\alpha'(G)$ - **количество рёбер** в **максимальном** паросочетании графа $G$.
>  *Повторение*: $\beta(G)$ **количество вершин** в **минимальном** вершинном покрытии графа $G$
> *Повторение* [билет 1](#билет-1.-независимые-множества-паросочетания-и-покрытия-в-графе.-теорема-галлаи.)

#### Доказательство (сначала $\leq$, потом $\geq$)
$\leq$
Так как рёбра паросочетания не имеют общих концов, то в любом вершинном покрытии не меньше вершин, чем в любом паросочетании рёбер. Следовательно, $\alpha'(G) \leq \beta(G)$.

$\geq$
- Пусть $M$ — максимальное паросочетание в графе $G$, 
$U_1$ — множество всех непокрытых этим паросочетанием вершин $V_1$,  
$U_2$ — множество непокрытых $M$ вершин $V_2$.
- Разобьём все покрытые паросочетанием $M$ вершины $V_1$ на два множества: $Y_1$ — те вершины, до которых можно дойти от $U_1$ по $M$-чередующимся путям, а $Z_1$ — вершины, до которых дойти таким образом нельзя.
- Разобьём все покрытые паросочетанием $M$ вершины $V_2(G)$ на два множества: $Y_2$ — те вершины, до которых можно дойти от $U_1$ по $M$-чередующимся путям, а $Z_2$ — вершины, до которых дойти таким образом нельзя
- Выясним, как должны проходить рёбра паросочетания $M$ и остальные рёбра графа $G$ между определенными выше множествами вершин. На рисунке сплошными линиями показаны рёбра паросочетания $M$, пунктирными линиями — невозможные рёбра. 
Далее мы объясним, почему граф устроен именно так.
- Любой $M$-чередующийся путь приходит в вершины множества $Y_1$ по ребрам из $M$, поэтому предыдущая вершина перед $Y_1$ на таком пути должна лежать в $Y_2$.
- Рёбра паросочетания $M$ не могут соединять $Y_2$ c $Z_1$ (иначе был бы $M$-чередующийся путь от $U_1$ до $Z_1$). 
Следовательно, паросочетание $M$ соединяет друг с другом $Y_1$ и $Y_2$ а также $Z_1$ и $Z_2$

**Докажем, что $B = Z_1 \cup Y_2$ — вершинное покрытие.**
- $E_G (U_1 \cup Y_1, Z_2) = \varnothing$. (Рёбра не из $M$ не могут соединять вершины из $U_1 \cup Y_1$ c вершинами из $Z_2$: иначе был бы $M$-чередующийся путь от $U_1$ до $Z_2$)
- $E_G (U_1 \cup Y_1, U_2) = \varnothing$. (Если бы такое ребро существовало, то существовал бы $M$-дополняющий путь, что по теореме Бержа для максимального паросочетания $M$ невозможно.)
Так как $B$ — вершинное покрытие и $|M| = |B|$, имеем $\alpha'(G) \geq \beta(G)$.
![photo](https://github.com/Dkanil/ITMO/blob/6c965ea91ef4991295864b2663ff2a2465ac9e2d/semester1/DM/Konig.png?raw=true)
### Следствие из теорем Кенига и Галлаи
Пусть $G$ — двудольный граф с $\delta(G) > 0$. Тогда $\alpha(G) = \beta'(G)$.

#### Доказательство
- По [Теореме Кёнига](#теорема-кёнига) для двудольного графа выполняется соотношение $\alpha'(G) = \beta(G)$.
- По [Лемме 1](#лемма-1) для любого графа
$\alpha(G) + \beta(G) = v(G)$ 
- По [Теореме Галлаи](#теорема-галлаи) , так как $\delta(G)>0$, то
$\alpha'(G) + \beta'(G) = v(G)$
Решив систему, следует, что $\alpha(G) = \beta'(G)$.

## Билет 7. Паросочетания с предпочтениями. Теорема Гэйла-Шепли.
> Иногда вершинам не всё равно, с какими вершинами “вступать в паросочетание”. 
> Предположим, что каждая вершина имеет список предпочтений, то есть, упорядочивает инцидентные ей рёбра. 
> Построим такое паросочетание $M$ (не обязательно максимальное), что в нём не будет ребра $e = ab$, которое обе вершины $a$ и $b$ хотели бы поменять на свободные рёбра. Дадим строгие определения

1) Пусть для каждой вершины $v \in V (G)$ задано линейное отношение (нестрогого) порядка $\leq_v$ на множестве всех инцидентных $v$ рёбер из $E(G)$. Тогда $≤ \ = \{≤_v \}_{v ∈V (G )}$ — **множество предпочтений**.
>Например, если у вершины $v$ есть рёбра $e_1$, $e_2$,$e_3$​, то она может сказать, что $e_1 \leq_v e_2 \leq_v e_3$​, где $e_1$​ наименее предпочтительное ребро, а $e_3$​ — наиболее

2) Паросочетание $M$ называется стабильным для множества предпочтений $\leq$, если для любого ребра $f \not\in M$ существует такое ребро $e \in M$, что $e$ и $f$ имеют общий конец $v$ и $f \leq_v e$.

> *Объяснение* $f \leq_v e$:  вершина $v$ предпочитает ребро $e$, уже включённое в паросочетание, ребру $f$, которого нет в паросочетании.
> 
> Ни одно ребро $f \not\in M$ не может "разрушить" стабильность, потому что для вершины $v$, которая соединена с $f$, уже существует ребро $e \in M$, которое для этой вершины лучше (или равно по предпочтению), чем $f$, а значит ребро $f$ не может быть включёно в стабильное паросочетание.

### Stable marriage theorem (теорема о деревенских свадьбах)
**(D. Gale, L. Shapley, 1962.)** Пусть $G$ — двудольный граф. Тогда для любого множества предпочтений $\leq$ в графе $G$ существует стабильное паросочетание.

#### Доказательство
- Будем считать вершины **одной доли мужчинами**, а вершины **другой доли — женщинами**, а наше паросочетание будет состоять из семейных пар. **Изначально наше паросочетание пусто**, оно будет изменяться пошагово. 

*Опишем шаг алгоритма изменения паросочетания*.
- Сначала действуют **мужчины**:
каждый **неженатый** (то есть, не покрытый паросочетанием) **мужчина выбирает женщину**, которая ему больше всех нравится (то есть, наивысшую в своем предпочтении) из тех, **которым он еще не делал предложения** (если такие есть), после чего делает ей предложение.
- Затем действуют **женщины**:
каждая из них **рассматривает всех мужчин**, кто сделал ей предложение и нравится ей строго больше, чем ее муж (если он есть). Если это множество непусто, она **выбирает из них того, кто нравится ей больше всего** (если таких несколько, то любого из них) и выходит за него замуж (вместо ее прежнего мужа, если он был) ~~ш-общительная~~.
- Конечность алгоритма очевидна: никакой мужчина **не делает предложение одной женщине дважды**. Пусть в результате получилось паросочетнание M.

*Докажем, что* $M$ *стабильно*. 
- Рассмотрим любое ребро $uw \in E(G) \setminus M$ (где $u$ — мужчина).
- Если $u$ делал предложение $w$ , то 
	- либо $w$ ему отказала, 
	- либо сначала приняла предложение, но потом бросила, 
- Значит $w$ нашла мужа $u'$, который ей нравится не меньше, чем $u$ (то есть, существует ребро $u'w \in M$, для которого $uw \leq_w u'w$).
- Если же $u$ не делал предложения $w$ , то в процессе алгоритма нашел жену $w'$, которая нравится ему не меньше, чем $w$ (то есть, существует ребро $uw' \in M$, для которого $uw \leq_u uw'$).
- Таким образом, построеннное паросочетание стабильно по определению. 

## Билет 8. Теорема Татта о совершенном паросочетании.
> *Обозначение*: $o(G)$ - количество нечётных компонент связности произвольного  графа $G$ (то есть, компонент связности, содержащих нечётное число вершин).
### Теорема Татта
**(W. T. Tutte, 1947.)** В графе $G$ существует совершенное паросочетание тогда и только тогда, когда для любого $S \subset V (G)$ выполняется условие $o(G − S) \leq |S|$
> *Повторение* Совершенное паросочетание $M$ графа $G$ - покрывающее все вершины графа.
> *Повторение* [билет 1](#билет-1.-независимые-множества-паросочетания-и-покрытия-в-графе.-теорема-галлаи.)

#### Доказательство
$\Rightarrow$ 
- Необходимость условия почти очевидна. 
- Пусть $S \subset V (G)$, а $M$ — совершенное паросочетание. 
- Тогда одна из вершин каждой нечетной компоненты связности графа $G − S$ должна быть соединена с вершиной из $S$ ребром паросочетания $M$ и все эти вершины — разные!
> *Объяснение*: должна быть соединена с вершиной из $S$ (*в нечетной компоненте связности нечётное число вершин* $\Rightarrow$ *останется ровно одна вершина, непокрытая паросочетанием*), 
> *Объяснение*: все эти вершины разные (*так как паросочетание совершенное*)
- А значит должно выполняться $o(G − S) \leq |S|$

$\Leftarrow$ 
- Предположим, что граф удовлетворяет условию, но не имеет совершенного паросочетания. Тогда, в частности, $o(G-\varnothing) \leq |\varnothing| = 0$, то есть, $v(G)$ чётно.
- Пусть $G^∗$ — максимальный надграф $G$ на том же множестве вершин, не имеющий совершенного паросочетания. Мы построим совершенное паросочетание в $G^∗$ и придем к противоречию.
- Для любого $S \subset V (G)$ очевидно, выполняется
неравенство $o(G^∗ − S) \leq o(G − S) \leq |S|$.
- Пусть $U = \{u \in V(G) : d_{G^∗}(u) = v (G) − 1\}$. Очевидно,
$G^∗$ — не полный граф, поэтому $U \neq V(G)$.
> *Объяснение*: из-за $d_{G^∗}(u) = v (G) − 1$ мы получили, что вершины $U$ смежны всем вершинам подграфа $G$

*Докажем, что граф* $G^∗ − \ U$ *— объединение нескольких несвязанных друг с другом полных графов*
##### Поддоказательство
- Предположим, что это не так. Тогда существуют такие вершины $x$, $y$ , $z \in V(G) \setminus U$, что $xy$, $yz \in E(G^∗)$, но $xz \not\in E(G^∗)$.
- Так как $y \not\in U$, то существует такая вершина $w \not\in U$, что $yw \not\in E(G^∗)$.
- Ввиду максимальности графа $G^∗$ существует совершенное паросочетание $M_1$ в графе $G^∗ + xz$ и совершенное паросочетание $M_2$ в графе $G^∗ + yw$. Так как в графе $G^∗$ нет совершенного паросочетания, $xz \in M_1$ и $yw \in M_2$.
- Пусть $H = (V(G), M_1 \Delta M_2)$. Очевидно, граф $H$ — несвязное объединение чётных циклов, в каждом из которых чередуются рёбра паросочетаний $M_1$ и $M_2$.
> *Объяснение*: $M_1 \Delta M_2$ - симметрическая разность

- Рёбра $xz$ и $yw$ принадлежат ровно одному из паросочетаний $M_1$ и $M_2$, и потому лежат в $E(H)$.
- На вершинах любой компоненты связности графа $H$ существует совершенное паросочетание с рёбрами из $M_1$ и совершенное паросочетание с рёбрами из $M_2$.

*Рассмотрим два случая*.
**Случай 1. Рёбра** $xz$ **и** $yw$ **лежат в разных компонентах** $C_1$ **и** $C_2$ **графа** $H$
- Тогда на вершинах $C_1$ мы выберем рёбра паросочетания $M_2$, на вершинах $C_2$ мы выберем рёбра паросочетания $M_1$, а в остальных компонентах графа $H$ — любое из этих паросочетаний.
- В итоге получится совершенное паросочетание графа $G^∗$, противоречие.

**Случай 2. Рёбра** $xz$ **и** $yw$ **лежат в одной компоненте** $C$ **графа** $H$.
![Tutte](https://github.com/Dkanil/ITMO/blob/main/semester1/DM/Tutte.png?raw=true)
- В силу симметричности $x$ и $z$ можно считать, что вершины расположены в чётном цикле $C$ в порядке $ywzx$ (см. рисунок).
- Рассмотрим простой путь $P = xCyzCw$ , состоящий из двух дуг цикла $C$ и ребра $yz$. Тогда $V(P) = V (C)$ и $E(P) \subset E(G^∗)$. Следовательно, существует совершенное паросочетание $M_C \subset E (G^∗)$ на вершинах компоненты связности $W$.
- В остальных компонентах графа $H$ выберем рёбра любого из паросочетаний $M_1$ и $M_2$. В итоге получится совершенное паросочетание графа $G^∗$, противоречие.

*Вернёмся к [основному доказательству](#поддоказательство)*
- Граф $G^∗ − \ U$ есть объединение нескольких несвязанных полных графов. В силу условия, среди них не более чем $|U|$ имеет нечетное число вершин.
- В каждой чётной компоненте графа $G^∗ − \ U$ мы построим полное паросочетание, в каждой нечётной компоненте — паросочетание, покрывающее все вершины, кроме одной, а оставшуюся вершину соединим с вершиной из $U$ (при этом мы используем различные вершины множества $U$: их хватит ввиду $o(G^∗ − \ U) \leq |U|)$.
- Наконец, мы разобём на пары оставшиеся непокрытыми вершины множества $U$: это можно сделать, так как каждая из этих вершин смежна в графе $G^∗$ со всеми остальными. Таким образом, мы получили совершенное паросочетание в графе $G^∗$, противоречие.

## Билет 9. Теорема Петерсена о совершенном паросочетании в регулярном графе степени 3.
1) **Кубический граф** - граф, все вершины которого имеют степень 3.
2) **Мост графа** — ребро, не входящее ни в один цикл

### Теорема Петерсена
**(J. Petersen, 1891.)** Пусть $G$ — связный кубический граф, в котором не более двух мостов. Тогда в графе $G$ есть совершенное паросочетание.
#### Доказательство
- Предположим, что совершенного паросочетания в $G$ нет. Тогда по [Теореме Татта](#теорема-татта) существует такое множество $S \subset V(G)$, что $o(G − S) > |S|$.
- Так как в кубическом графе четное число вершин, то $S \neq \varnothing$ и $o(G − S) \equiv |S| \pmod{2}$.
>  *Объяснение*:  в кубическом графе четное число вершин по лемме о рукопожатиях

- Пусть $U_1, \dots , U_n$ — все нечётные компоненты связности графа $G − S$. Тогда $n \geq |S| + 2$.
- Пусть $m_i = e_G (U_i , S)$. Тогда 
$m_i = (\sum_{v \in U_i} d_G (v )) − 2e(G (U_i)) = 3|U_i| − 2e(G(U_i))$ — очевидно, нечетно.
> *Объяснение:* Число рёбер, соединяющих $U_i$​ с $S$ равно общему числу рёбер, инцидентных вершинам $U_i$, без внутренних рёбер.
> *Объяснение:* $\sum_{v \in U_i} = 3|U_i|$, так как граф кубический 

- Так как не более чем два ребра графа $G$ — мосты, то не более, чем два числа из $m_1, \dots , m_n$ равны $1$, а все остальные — не менее, чем $3$.
- Тогда $3|S| = \sum_{v \in S} d_G (v) \geq \sum_{i=1}^n m_i \geq 3(n − 2) + 2 = 3n − 4 \geq 3(|S| + 2) − 4 > 3|S|$, противоречие. 

Результат теоремы Петерсона в некотором смысле наилучший возможный. 
Пример связного кубического графа с тремя мостами, у которого нет совершенного паросочетания:
![Petersen](https://github.com/Dkanil/ITMO/blob/main/semester1/DM/Petersen.png?raw=true)
## Билет 10. Теорема Петерсена о выделении 2-фактора в 2k-регулярном графе и ее следствия о регулярных факторах.
1) $k$-**фактором** графа $G$ называется его остовный
регулярный подграф степени $k$.
> *Повторение*: остовный подграф - покрывает все вершины графа
> *Повторение*: регулярный граф - все степени вершин равны

> Совершенное паросочетание — это 1-фактор.

### Теорема Петерсена о выделении 2-фактора в 2k-регулярном графе
**(J. Petersen, 1891.)** У регулярного графа степени $2k$
есть $2$-*фактор*.
#### Доказательство
- Граф $G$ имеет эйлеров цикл. Обойдем его в некотором направлении и ориентируем каждое ребро в направлении обхода. Тогда в каждую вершину $G$ входит и выходит ровно по $k$ стрелок.
> *Повторение*: Эйлеров цикл - по всем рёбрам ровно 1 раз
> *Повторение*: Условие эйлерова цикла - все степени вершин чётны
> 
- Построим граф $G^∗$ следующим образом. Разделим каждую вершину $v \in V(G)$ на две вершины $v_1$ и $v_2$. 
- Если ребро $xy \in E(G)$ ориентировано в обходе Эйлерова цикла от $x$ к $y$ , то проведем в графе $G^∗$ ребро $x_1y_2$.
- Таким образом, существует биекция $\varphi : E(G) \to E (G^∗)$,
заданная правилом $\varphi(xy) = x_1y_2$.
- $G^∗$ — регулярный двудольный граф степени $k$ с долями
$\{v_1\}_{v \in V(G)}$ и$\{v_2\}_{v \in V(G)}$.
- По [2 следствию из теоремы Холла](#следствие-2) в графе $G^∗$ есть совершенное паросочетание $M^∗$.
- Пусть $M = \varphi^{−1}(M^∗)$ ($M$ состоит из рёбер графа $G$ — прообразов рёбер $M^∗$ при биекции $\varphi$).
- Для любой вершины $x \in V(G)$ каждая из вершин $x_1$, $x_2 \in V(G^∗)$ инцидентна ровно одному ребру из $M^∗$. 
- Поэтому $x$ инцидентна ровно двум рёбрам из $M$, то есть, $M$ — это $2$-*фактор* графа $G$ .

### Следствия о регулярных факторах
1) Регулярный граф степени $2k$ есть объединение $k$ своих
$2$-факторов.
2) Для любого $r \leq k$ регулярный граф степени $2k$ имеет
$2r$-фактор.

> Все остальные утверждения вида “у регулярного графа степени $k$ есть фактор степени $r$ ” без дополнительных условий на граф неверны. 
> Пример графа, на котором подобные утверждения не будут работать:
![Petersen](https://github.com/Dkanil/ITMO/blob/main/semester1/DM/Petersen.png?raw=true)

## Билет 11. Теорема Томассена о почти регулярном факторе почти регулярного графа.
**(C. Thomassen, 1981.)** Пусть $G$ — граф, степени всех вершин которого равны $k$ или $k + 1$, а $r < k$. Тогда существует остовный подграф $H$ графа $G$, степени всех вершин которого равны либо $r$, либо $r + 1$.
#### Доказательство
(Докажем по индукции спуском по $r$ вниз)
***База*** для $r = k$ очевидна, в этом случае подойдет $H = G$
***Индукционный переход*** $r \to r − 1$
- Пусть граф $G$ имеет остовный подграф $F$, степени вершин которого равны $r$ или $r + 1$.
- Начиная с графа $F$ , пока это возможно, будем производить следующую операцию: удалять ребро, соединяющее две вершины степени $r + 1$. В результате получится подграф $F'$ графа $F$, степени вершин которого равны $r$ или $r + 1$, в котором никакие две вершины степени $r + 1$ не смежны.
- Пусть $V_{r+1}$ — множество всех вершин степени $r + 1$ в графе $F'$. Можно считать, что $V_{r+1} \neq \varnothing$, иначе граф $F'$ нам подходит и теорема доказана.
- Пусть $V_r = V(G) \setminus V_{r +1}$, а $B$ — двудольный граф с долями $V_{r+1}$ и $V_r$ , ребра которого — это $E_{F'}(V_{r+1}, V_r)$.
- Для каждой вершины $x \in V_{r+1}$ мы имеем $d_B(x) = r + 1$, а для каждой вершины $y \in V_r$ мы имеем $d_B(y) \leq r$ .
- По [1 cледствию из теоремы Холла](#следствие-1), в графе $B$ существует паросочетание $M$, покрывающее все вершины из $V_{r+1}$.
- Степени всех вершин графа $H = F' − M$ равны $r$ или $r − 1$.

## Билет 12. Дефицит графа. Формула Бержа.
1) Пусть $S \subset V(G)$ таково, что $o(G − S) > |S|$. Мы будем называть $S$ **множеством Татта** графа $G$ .

> По [теореме Татта](#теорема-татта), если в графе $G$ нет совершенного паросочетания, то в нём есть хотя бы одно множество Татта.

2) **Дефицитом** графа G мы будем называть величину $\text{def}(G) := v(G) - 2\alpha'(G)$.
> *Повторение:* $\alpha'(G)$ - **количество рёбер** в **максимальном** паросочетании графа $G$.
> *Повторение* [билет 1](#билет-1.-независимые-множества-паросочетания-и-покрытия-в-графе.-теорема-галлаи.)

> Дефицит графа $G$ — это количество вершин, не покрытых максимальным паросочетанием графа $G$.
- Очевидно, $\text{def}(G ) = 0$ тогда и только тогда, когда в графе $G$ есть совершенное паросочетание.
- Определение дефицита можно переписать в виде формулы для вычисления размера максимального паросочетания:
$$\alpha'(G ) = \frac{v(G) − \text{def}(G)}{2}$$

### Формула Бержа
**(C. Berge, 1958.)** Для любого графа $G$ выполняется равенство
$$\text{def}(G) = \max_{S \subset V(G)} \left( o(G - S) - |S| \right)$$
#### Доказательство
$\geq$
- Пусть $M$ — максимальное паросочетание графа $G$, 
$S \subset V(G)$, $n = o(G − S)$, а $U_1, \dots , U_n$ — все нечётные компоненты связности графа $G − S$.
- В каждой нечётной компоненте $U_i$ существует хотя бы одна вершина $u_i$, которая не покрыта ребром $M$ или покрыта ребром $e_i = u_ix_i \in M$, где $x_i \in S$.
- Следовательно, не менее, чем $n − |S|$ из вершин $u_1, \dots, u_n$ не покрыты паросочетанием $M$, откуда следует неравенство 
$$\text{def}(G) \geq o(G - S) - |S|$$

$\leq$
- Пусть $$k = \max_{S \subset V(G)} \left( o(G - S) - |S| \right)$$
- Если $k = 0$, то по [теореме Татта](#теорема-татта) в графе $G$ есть совершенное паросочетание и $\text{def}(G) = 0$, этот случай тривиален.
- Пусть $k > 0$, $W$ — множество из $k$ новых вершин $(W \cap V (G) = \varnothing)$, а граф $H$ получен присоединением к $G$ вершин множества $W$, причём каждая из вершин множества $W$ будет смежна со всеми остальными вершинами графа $H$.

*Покажем, что для графа* $H$ *выполняется условие Татта.*
- Понятно, что $k \equiv v(G) \pmod{2}$, поэтому $v(H) = v(G) + k$ чётно. Таким образом, достаточно проверить условие для непустых множеств $T \subset V(H)$.
- Если $T \not\supset W$, то граф $H − T$ связен и $o(H − T) \leq 1 \leq |T|$.
- Если $T = W \cup S$, где $S \subset V(G)$, то 
$o(H − T) = o(G − S) \leq k + |S| = |T|$.
- В обоих случаях условие Татта выполняется и по [теореме Татта](#теорема-татта) в графе $H$ есть совершенное паросочетание $N$.
- Тогда в графе $G$ существует такое паросочетание $M$, что $|M| \geq |N| − k$, следовательно, $$\alpha'(G) \geq |M| = |N| - k = \frac{v(H)}{2} - k = \frac{v(G)+k}{2} - k = \frac{v(G)-k}{2}$$ 
- откуда получим $k \geq v(G) - 2\alpha'(G)$
- подставив $k$ и дефицит графа по его определению, получим искомое неравенство:
 $$\text{def}(G) \leq \max_{S \subset V(G)} \left( o(G - S) - |S| \right)$$

# Глава 3.2. Элементарная комбинаторика

## Билет 1. Число сочетаний из n элементов по k. Формула для числа сочетаний.
**Число сочетаний** из $n$ элементов по $k$ — это количество $k$-элементных подмножеств в $n$-элементном множестве (где $0 \leq k \leq n$).
- Возможные обозначения: $C_n^k$ или $\binom{k}{n}$.
- Это число можно интерпретировать как
	- число **строго** монотонно возрастающих функций $f : [1..k] \to [1..n]$;
	- число способов разложить $k$ одинаковых шаров по $n$ пронумерованным ящикам (в каждый ящик помещается не более одного шара)

### Формула для числа сочетаний
$C_n^k = \frac{n!}{k!(n−k)!}$

#### Доказательство
Пусть $|X| = n$.
• Есть $A_n^k = n(n − 1) \dots (n − k + 1) = \frac{n!}{(n−k)!}$ способов выбрать последовательность из $k$ различных элементов $X$.
• Каждая такая последовательность задает $k$-элементное подмножество $X$.
• Каждое подмножество посчитано $k!$ раз, ибо его элементы можно упорядочить $k!$ способами. Итого, $\frac{n!}{k!(n−k)!}$ различных подмножеств.

>*Повторение:* $A_n^k$ Число размещений из $n$ элементов по $k$ — это количество последовательностей длины $k$, составленных из различных элементов $n$-элементного множества.

## Билет 2. Число сочетаний с повторениями из n элементов по k. Формула для числа сочетаний с повторениями.
- **Число сочетаний с повторениями** из $n$ элементов по $k$ — это количество *неупорядоченных* наборов из $k$ элементов $n$-элементного множества (в отличии от множества, в наборе один и тот же элемент может встречаться несколько раз).
- Возможные обозначения: $\widetilde{C}_n^k$ или $\left(\binom{n}{k}\right)$.
- Это число можно интерпретировать как
	- число **нестрого** монотонно возрастающих функций $f : [1..k] → [1..n]$;
	- число способов разложить $k$ неразличимых шаров по $n$ ящикам (в ящик можно класть любое число шаров);
	- число способов выбрать $k$ предметов, если есть предметы $n$ типов 
	(на складе есть хотя бы по $k$ предметов каждого типа; 
	предметы одного типа абсолютно неразличимы).
	
### Лемма
Число решений уравнения $$t_1 + t_2 + \dots + t_n = k \tag{1}$$ в $\mathbb{N}_0$ равно $\widetilde{C}_n^k$.
#### Доказательство. 
- Пусть $X = \{x_1, x_2, \dots , x_n\}$.
- Строим биекцию между решениями уравнения (1) и неупорядоченными наборами из $k$ элементов множества $X$.
- Каждому решению $(t_1, t_2, \dots, t_n)$ ставим в соответствие набор, состоящий из $t_1$ экземпляров элемента $x_1, t_2$ экземпляров $x_2, \dots, t_n$ экземпляров $x_n$.
- Обратно, каждому набору $\mathcal{T}$ ставим в соответствие решение $(t_1, t_2, \dots, t_n)$, где $t_i$ — число экземпляров $x_i$ в $\mathcal{T}$.

### Формула для числа сочетаний с повторениями
$\widetilde{C}_n^k = C_{n+k-1}^{n-1} = C_{n+k-1}^{k}$
#### Доказательство
- Расположим в ряд  $k$ шариков и $n − 1$ перегородку.
- Всего есть $C_{n+k-1}^{k}$ таких расположений.
- Обозначим через $t_1$ число шариков до первой перегородки; $t_2$ — между первой и второй перегородками; $\dots$ ; $t_n$ — после $(n − 1)$-й перегородки.
- Получаем биекцию между решениями уравнения (1) и такими расположениями шаров и перегородок, а значит $C_{n+k-1}^{k} = \widetilde{C}_n^k$.

## Билет 3. Простейшие свойства биномиальных коэффициентов. Алгебраические и комбинаторные доказательства. Треугольник Паскаля.
### Свойство 1
$C_{n}^{k} = C_{n}^{n-k}$ (очевидно)

### Свойство 2 
$C_{n+1}^{k+1} = C_{n}^{k} + C_{n}^{k+1}$
#### Алгебраическое доказательство 
$C_{n}^{k} + C_{n}^{k+1} = \frac{n!}{k!(n-k)!} + \frac{n!}{(k+1)!(n-k-1)!} = \frac{n! \cdot (k+1)}{(k+1)!(n-k)!} + \frac{n! \cdot (n-k)}{(k+1)!(n-k)!} = \frac{n! \cdot (n+1)}{(k+1)!(n-k)!} = C_{n+1}^{k+1}$

#### Комбинаторное доказательство 
- Пусть $X = \{x_0, x_1, \dots, x_n\}$.
- $(k + 1)$-элементные подмножества $X$ бывают двух видов: содержащие $x_0$ и не содержащие $x_0$.
- Если $x_0 \not\in S \subset X$ , то $S \subset X' = \{x_1, \dots, x_n\}$. Таких подмножеств $C_n^{k+1}$.
- Если $x_0 \in S \subset X$ , то удалим $x_0$ из $S$. Получим подмножество $S' \subset X'$, где $|S'| = k$. Таких подмножеств $C_n^k$.

### Треугольник Паскаля
$\begin{array}{cccccc} 
	& & & & & 1\\ 
	& & & & 1 & & 1\\ 
	& & & 1 & & 2 & & 1 \\ 
	& & 1 & & 3 & & 3 & & 1 \\ 
	& 1 & & 4 & & 6 & & 4 & & 1 \\ 
	1 & & 5 & & 10 & & 10 & & 5 & & 1 \\ 
\end{array}$

$kC_n^k = nC_{n-1}^{k-1}$.
#### Алгебраическое доказательство 
$kC_n^k = k \cdot \frac{n!}{k!(n-k)!} = \frac{n!}{(k-1)!(n-k)!} = n \cdot \frac{(n-1)!}{(k-1)!((n-1)-(k-1))!} = nC_{n-1}^{k-1}$.
#### Комбинаторное доказательство 
Как в левой, так и в правой части формулы записано число $k$-элементных подмножеств $n$-элементного множества, в которых один элемент отмечен.

## Билет 4. Бином Ньютона. Сумма и знакопеременная сумма биномиальных коэффициентов (алгебраические и комбинаторные доказательства).
### Бином Ньютона
$\displaystyle (a + b)^n = \sum_{k=0}^n C_{n}^{k} a^{n−k} b^k$
#### Доказательство 
- $(a + b)^n = \underbrace{(a + b)(a + b)\cdots(a + b)}_{n\text{ скобок}}$;
- слагаемое $a^{n−k} b^k$ получается, если из $k$ скобок выбрать $b$, а из остальных — $a$.
- Это можно сделать $C_{n}^{k}$ способами.

Другое название чисел $C_{n}^{k}$ — **биномиальные коэффициенты**.

### Свойство 1
$C_{n}^{0} + C_{n}^{1} + \cdots + C_{n}^{n} = (1 + 1)^n = 2^n$
#### Комбинаторное доказательство 
- В левой и в правой части записано
число подмножеств $n$-элементного множества.

### Свойство 2
$C_{n}^{0} - C_{n}^{1} + \cdots + (−1)^nC_{n}^{n} = (1 - 1)^n = 0$
#### Комбинаторное доказательство
*Докажем, что* $C_{n}^{0} + C_{n}^{2} + \cdots = C_{n}^{1} + C_{n}^{3} + \cdots$
- Пусть $X = \{x_1, \dots, x_n\}$.
- Построим биекцию между всеми четными и всеми нечетными подмножествами $X$.
- Пусть $f(S) \overset{\text{def}}{=}
\begin{cases}
	S \cup \{x_n\}, & x_n \notin S, \\
	S \setminus \{x_n\}, & x_n \in S.
\end{cases}$
- Получаем отображение $f : \mathcal{P}(X) \to \mathcal{P}(X)$, обладающее следующим свойством: $\forall S (f (f (S)) = S)$
	- Отображение, обладающее таким свойством называется **инволюцией**.
	- В частности, это означает, что $f$ обратно самому себе, следовательно, $f$ — биекция.
- При этом, $|S|$ и $|f(S)|$ всегда имеют разную четность.
- Таким образом, $f$ также задает биекцию между всем четными и всеми нечетными подмножествами $X$ 

### Свойство 3
$C_{n}^{0} + C_{n}^{2} + \cdots = C_{n}^{1} + C_{n}^{3} + \cdots = 2^{n-1}$

## Билет 5. Мультиномиальные коэффициенты. Определение и формула. Обобщенный бином Ньютона.
Пусть $n = k_1 + k_2 + \dots + k_m$, где $m \in \mathbb{N}$ и $n, k_1, k_2, . . . , k_m \in \mathbb{N}_0$. 
- **Мультиномиальным коэффициентом** (или **полиномиальным коэффициентом**) - число способов разбить $n$-элементное множество $X$ на $m$ непересекающихся подмножеств $X_1, X_2, \dots, X_m$, где $|X_i| = k_i$, обозначается  $\binom{n}{k_1, k_2, \dots, k_m}$.

### Формула мультиномиального коэффициента
$\displaystyle \binom{n}{k_1, k_2, \dots, k_m} = \frac{n!}{k_1! k_2! \dots k_m!}$

#### Доказательство
- Есть $n!$ способов упорядочить элементы множества $X$.
- Для каждого способа, помещаем первые $k_1$ элементов в $X_1$; 
следующие $k_2$ элементов в $X_2$ и т. д.
- Получаем разбиение $X$ на подмножества нужного размера.
- Каждое разбиение посчитано $k_1! k_2! \dots k_m!$ раз.

### Обобщенный бином Ньютона
$$(a_1 + a_2 + . . . + a_m)^n = \sum_{k_1 + k_2+ \dots + k_m=n} \binom{n}{k_1, k_2, \dots, k_m} a_1^{k_1} a_2^{k_2} \dots a_m^{k_m}$$

#### Доказательство
*Аналогично доказательству [Бинома Ньютона](#бином-ньютона)*
- При раскрытии скобок слагаемое $a_1^{k_1} a_2^{k_2} \dots a_m^{k_m}$ получается, если выбрать из $k_1$ скобок слагаемое $a_1$, из $k_2$ скобок слагаемое $a2$, $\dots$ , из $k_m$ скобок слагаемое $a_m$.
- Такой выбор можно сделать в точности $\displaystyle\binom{n}{k_1, k_2, \dots, k_m}$ способами.

## Билет 6. Формула включений-исключений. Переформулировка этой формулы в терминах свойств.
1) Пусть $A, B$ — конечные множества. Тогда 
$|A \cup B| = |A| + |B| − |A \cap B|$

2) Пусть $A, B, C$ — конечные множества. Тогда
$|A \cup B \cup C | = |A| + |B| + |C| − |A \cap B| − |B \cap C | − |C \cap A| + |A \cap B \cap C |$

### Формула включений-исключений
Пусть $A_1, \dots , A_n$ — конечные множества. Тогда
$$\left|\bigcup_{i=1}^n A_i \right| = \sum_{\varnothing \neq I \subset [1..n]} (-1)^{|I|+1} \left|\bigcap_{i \in I} A_i \right| \tag{1}$$
> *Объяснение*: $\varnothing \neq I \subset [1..n]$ - $I$ пробегает все непустые подмножества множества индексов $[1..n]$.

#### Доказательство
- Пусть $x \in A_{i_1} , \dots , A_{i_k}$ и $x$ не принадлежит остальным $A_j$.
- Тогда $x$ учитывается в формуле (1) с коэффициентом $\displaystyle \sum_{\ell=1}^k (−1)^{\ell+1} C^\ell_k = 1$
- Так как каждый элемент учитывается ровно 1 раз, то формула (1) верна

### Формула включений-исключений в терминах свойств
Пусть $X$ — конечное множество, $|X| = N$;
- $P_1, \dots, P_n$ — свойства элементов множества $X$ (т. е. одноместные предикаты на $X$);
>*Повторение*: **Предикат** — это логическая функция или высказывание, зависящее от одного(**одноместный**) или нескольких(**многоместный**) аргументов, которое может быть либо **истинно**, либо **ложно**.
-  $N_{i_1, \dots,i_k}$ — число элементов, удовлетворяющих $P_{i_1}, \dots, P_{i_k}$;
- $N(0)$ — число элементов, не удовлетворяющих ни одному свойству.
Тогда
$$N(0) = N − \sum_i N_i + \sum_{i_1<i_2} N_{i_1,i_2} − \\ \dots + (−1)^k \sum_{i_1< \dots <i_k} N_{i_1, \dots, i_k} + \dots + (−1)^nN_{1, \dots, n} \tag{2}$$

## Билет 7. Субфакториалы. Определение и рекуррентное соотношение для субфакториалов. Связь с обычными факториалами.
1) **Перестановкой** на множестве $M$ называется произвольная биекция $\sigma : M \to M$.
2) **Неподвижной точкой** перестановки $\sigma$ называется такой элемент $x \in M$, что $\sigma(x) = x$.
3) $S_n$ — множество всех перестановок на $[1..n]$.
>*Повторение:* $|S_n| = n!$

4) $D(n)$ — (**Субфакториал**) число перестановок из $S_n$, **не имеющих** *неподвижных точек*.

### Рекуррентная формула субфакториала
$D(n + 1) = n(D(n) + D(n − 1))$
#### Доказательство
Пусть $\sigma \in S_{n+1}; k = \sigma(n + 1); \ell = \sigma^{−1}(n + 1)$
> *Объяснение:* $k$ - куда переставили $(n+1)$-й элемент, а $\ell$ - откуда переставили
- Возможны два случая: $k \neq \ell$ или $k = \ell$.
	1) Пусть $k \neq \ell$:
		- Тогда $\sigma'(x) \overset{\text{def}}{=}
			\begin{cases}
				 \sigma(x), & x \neq \ell, \\
				k, & x = \ell,
			\end{cases}$ — перестановка из $S_n$ без неподвижных точек.
		- Для каждого $k \in [1..n]$ есть $D(n)$ таких перестановок.
	2) Пусть $k = \ell$:
		- Тогда $\sigma|_{[1..n]\setminus \{k\}}$ — перестановка на $[1..n]\setminus \{k\}$ без неподвижных точек.
		- Для каждого $k \in [1..n]$ есть $D(n − 1)$ таких перестановок.
- Итого, получаем $nD(n) + nD(n − 1)$ перестановок без неподвижных точек.

> $D(n)$ — **Субфакториал**, так как для обычных факториалов выполняется такое же соотношение: $(n + 1)! = n(n! + (n − 1)!)$

## Билет 8. Явная формула для субфакториала. Следствие о ближайшем целом числе к $\frac{n!}{e}$.
### Явная формула субфакториала
$\displaystyle D(n) = n! \sum_{k=0}^n \frac{(−1)^k}{k!}$
#### Доказательство
Пусть $X = S_n$
- $P_i$ — свойство $“\sigma(i) = i”$ для перестановки $\sigma \in S_n$
- Тогда $N = n!$ и $N_{i_1, \dots,i_k} = (n − k)!$
- По формуле [включений-исключений](#формула-включений-исключений-в-терминах-свойств) имеем: $\displaystyle D(n) = \sum_{k=0}^n (−1)^k (n − k)!C_n^k = n!\sum_{k=0}^n \frac{(−1)^k}{k!}$

### Следствие
$D(n) = \text{round}(\frac{n!}{e})$; более того, $|D(n) − \frac{n!}{e} | < \frac{1}{n+1}$
#### Доказательство
Напомним, что $\displaystyle e^x = \sum^\infty_{k=0} \frac{x^k}{k!}$, тогда
> *Абсолютно очевидные действия:* 
> Разложим $\displaystyle e^x = \lim_{n \to \infty} \left(1 + \frac{x}{n}\right)^n$ с использованием бинома Ньютона: 
> $\displaystyle \lim_{n \to \infty} \left(1 + \frac{x}{n}\right)^n = \lim_{n \to \infty} \left(\sum_{k=0}^n C^n_k\left(\frac{x}{n}\right)^k\right) = \lim_{n \to \infty} \left(\sum_{k=0}^n \frac{n!}{k!(n-k)!}\left(\frac{x}{n}\right)^k \right) = \lim_{n \to \infty} \left(\sum_{k=0}^n \frac{n^k}{k!}\frac{x^k}{n^k} \right) = \sum^\infty_{k=0} \frac{x^k}{k!}$
- $\displaystyle \frac{n!}{e} = n!\sum_{k=0}^\infty \frac{(-1)^k}{k!} = n! \sum_{k=0}^n \frac{(-1)^k}{k!} + n! \sum_{k=n+1}^\infty \frac{(-1)^k}{k!} = D(n) + (-1)^{n+1} \sum_{\ell=1}^\infty \frac{(-1)^{\ell + 1} n!}{(n + \ell)!}$;
- $\displaystyle \left|D(n) - \frac{n!}{e}\right| = \left|\sum_{\ell=1}^\infty \frac{(-1)^{\ell + 1} n!}{(n + \ell)!}\right| = \left| \frac{1}{n+1} - \frac{1}{(n+1)(n+2)} + \frac{1}{(n+1)(n+2)(n+3)} - \dots \right|$
- $\displaystyle \sum_{\ell=1}^\infty \frac{(-1)^{\ell + 1} n!}{(n + \ell)!} = \left( \frac{n!}{(n+1)!} - \frac{n!}{(n+2)!}\right) + \left( \frac{n!}{(n+3)!} - \frac{n!}{(n+4)!}\right) + \dots > 0$
- $\displaystyle \sum_{\ell=1}^\infty \frac{(-1)^{\ell + 1} n!}{(n + \ell)!} = \frac{1}{n+1} - \left( \frac{n!}{(n+2)!} - \frac{n!}{(n+3)!}\right) - \left( \frac{n!}{(n+4)!} - \frac{n!}{(n+5)!}\right) - \dots < \frac{1}{n+1}$.

## Билет 9. Функция Эйлера. Определение и формула (доказательство с помощью формулы включений-исключений).
1) Натуральные числа $a$ и $b$ называются **взаимно простыми**, если у них нет общего натурального делителя, отличного от единицы.
2) $\varphi (n)$ — количество натуральных чисел, меньше либо равных $n$ и взаимно простых с $n$ (**функция Эйлера**).

### Формула функции Эйлера
Пусть $n = p^{a_1}_1 \cdots p^{a_s}_s$ (где $p_1, \dots, p_s$ — различные простые и $a_1, \dots, a_s$ — натуральные числа). Тогда
$$\varphi (n) = n(1-\frac{1}{p_1}) \cdots (1-\frac{1}{p_s})$$
#### Доказательство
Пусть $X = [1..n]$.
- $P_i$ — свойство $“x \ \vdots\  p_i ”$ для числа $x \in X$
- Тогда $N_{i_1, \dots, i_k} = \frac{n}{p_{i_1} p_{i_2} \cdots p_{i_k}}$
- По формуле [включений-исключений](#формула-включений-исключений-в-терминах-свойств) имеем: 
$$\varphi (n) = \sum_{k=0}^n (-1)^k \sum_{1 \leq i_1 < i_2 < \dots < i_k \leq s} \frac{n}{p_{i_1} p_{i_2} \cdots p_{i_k}} = n(1-\frac{1}{p_1}) \cdots (1-\frac{1}{p_s})$$

## Билет 10. Формула для числа сюръекций.
### Формула числа сюръективных отображений
Пусть $f: [1..k] \to [1..n]$ - сюръекция, тогда
$\displaystyle \sum_{s=1}^n (−1)^{n−s} C^s_n s^k$ - число сюръекций
#### Доказательство
- Пусть $X$ — множество всех отображений $f: [1..k] \to [1..n]$
- $P_i$ — свойство $“f ^{−1}(i) = \varnothing”$ для отображения $f \in X$
	- Тогда $N = |X | = n^k$
	- $N_{i_1, \dots, i_\ell} = (n − \ell)^k$ — количество функций, удовлетворяющих данным $\ell$ свойствам.
	- $f \in X$ — сюръекция $\Leftrightarrow f$ не удовлетворяет ни одному из свойств. Следовательно, число сюръекций равно $N(0)$.
> $N(0)$ — число элементов, не удовлетворяющих ни одному свойству
- По формуле [включений-исключений](#формула-включений-исключений-в-терминах-свойств) имеем:
$$N(0) = \sum_{\ell = 0}^n (−1)^\ell C^\ell_n (n − \ell)^k = \sum_{s = 1}^n (−1)^{n-s} C^s_n s^k$$
> Последнее равенство получено заменой переменной $s = n - \ell$
