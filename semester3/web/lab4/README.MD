# Лабораторная работа 4
## Вариант 471346
Переписать приложение из предыдущей лабораторной работы с использованием следующих технологий:
- Уровень back-end должен быть основан на Spring.
- Уровень front-end должен быть построен на Angular 2+ с использованием обычных полей ввода HTML
- Взаимодействие между уровнями back-end и front-end должно быть организовано посредством REST API.

Приложение по-прежнему должно включать в себя 2 страницы - стартовую и основную страницу приложения. Обе страницы приложения должны быть адаптированы для отображения в 3 режимах:
- "Десктопный" - для устройств, ширина экрана которых равна или превышает 1155 пикселей.
- "Планшетный" - для устройств, ширина экрана которых равна или превышает 890, но меньше 1155 пикселей.
- "Мобильный"- для устройств, ширина экрана которых меньше 890 пикселей.

Стартовая страница должна содержать следующие элементы:
- "Шапку", содержащую ФИО студента, номер группы и номер варианта.
- Форму для ввода логина и пароля. Информация о зарегистрированных в системе пользователях должна храниться в отдельной таблице БД (пароль должен храниться в виде хэш-суммы). Доступ неавторизованных пользователей к основной странице приложения должен быть запрещён.

Основная страница приложения должна содержать следующие элементы:
- Набор полей ввода для задания координат точки и радиуса области в соответствии с вариантом задания: Button {'-2','-1.5','-1','-0.5','0','0.5','1','1.5','2'} для координаты по оси X, Text (-3 ... 5) для координаты по оси Y, и Button {'-2','-1.5','-1','-0.5','0','0.5','1','1.5','2'} для задания радиуса области. Если поле ввода допускает ввод заведомо некорректных данных (таких, например, как буквы в координатах точки или отрицательный радиус), то приложение должно осуществлять их валидацию.
- Динамически обновляемую картинку, изображающую область на координатной плоскости в соответствии с номером варианта и точки, координаты которых были заданы пользователем. Клик по картинке должен инициировать сценарий, осуществляющий определение координат новой точки и отправку их на сервер для проверки её попадания в область. Цвет точек должен зависить от факта попадания / непопадания в область. Смена радиуса также должна инициировать перерисовку картинки.
- Таблицу со списком результатов предыдущих проверок.
- Кнопку, по которой аутентифицированный пользователь может закрыть свою сессию и вернуться на стартовую страницу приложения.

Дополнительные требования к приложению:
- Все результаты проверки должны сохраняться в базе данных под управлением СУБД PostgreSQL.
- Для доступа к БД необходимо использовать Spring Data.

![Область](areas.png)

Дополнительное задание от преподавателя:
- Использовать jooq

## Вопросы к защите лабораторной работы:
1. Платформа Java EE. Спецификации и их реализации.
2. Принципы IoC, CDI и Location Transpanency. Компоненты и контейнеры.
3. Управление жизненным циклом компонентов. Дескрипторы развёртывания.
4. Java EE API. Виды компонентов. Профили платформы Java EE.
5. Компоненты EJB. Stateless & Stateful Session Beans. EJB Lite и EJB Full.
6. Работа с электронной почтой в Java EE. JavaMail API.
7. JMS. Реализация очередей сообщений. Способы доставки сообщений до клиента. Message-Driven Beans.
8. Понятие транзакции. Управление транзакциями в Java EE. JTA.
9. Веб-сервисы. Технологии JAX-RS и JAX-WS.
10. Платформа Spring. Сходства и отличия с Java EE.
11. Модули Spring. Архитектура Spring Runtime. Spring Security и Spring Data.
12. Реализация IoC и CDI в Spring. Сходства и отличия с Java EE.
13. Реализация REST API в Java EE и Spring.
14. React JS. Архитектура и основные принципы разработки приложений.
15. Компоненты React. State & props. "Умные" и "глупые" компоненты.
16. Разметка страниц в React-приложениях. JSX.
17. Навигация в React-приложениях. ReactRouter.
18. Управление состоянием интерфейса. Redux.
19. Angular: архитектура и основные принципы разработки приложений.
20. Angular: модули, компоненты, сервисы и DI.
21. Angular: шаблоны страниц, жизненный цикл компонентов, подключение CSS.
22. Angular: клиент-серверное взаимодействие, создание, отправка и валидация данных форм.

## Как запустить?
- Сгенерируйте в консоли секретный ключ: ```openssl rand -base64 64``` и вставьте его в application.properties 
в поле `jwt.secret`

### Для запуска локально (легче было сразу в докере делать, но ладно):
- Скачиваем "WildFly 20.0.0 Final" с https://www.wildfly.org
- Создаём пользователя для админки: ```.\wildfly-20.0.0.Final\bin\add-user.bat```
- Добавляем Datasource для PostgreSQL:
    - Открываем ```wildfly-20.0.0.Final\standalone\configuration\standalone.xml```
    - Ищем ```<datasources>```
    - Меняем параметр jndi-name на ```java:/jboss/datasources/PostgreDS```
    - Меняем параметр pool-name на ```PostgreDS```
    - параметр statistics-enabled убираем
    - В секции ```<driver>``` указываем имя драйвера ```postgresql```
    - В секции ```<connection-url>``` указываем URL вашей базы данных, например ```jdbc:postgresql://localhost:5432/studs```
    - В секции ```<user-name>``` указываем пользователя вашей базы данных
    - В секции ```<password>``` указываем пароль пользователя вашей базы данных
    - В секции ```<drivers>``` добавляем драйвер PostgreSQL:
      ```xml                    
      <driver name="postgresql" module="org.postgresql">
      <driver-class>org.postgresql.Driver</driver-class>
      </driver>
      ```
    - В ```<default-bindings>``` также меняем datasource на ```"java:jboss/datasources/PostgreDS"```
    - Копируем postgresql-42.7.7.jar из скачанного с помощью maven в ```wildfly-20.0.0.Final\modules\org\postgresql\main```
    - Создаём в той же директории файл module.xml со следующим содержимым:
  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <module xmlns="urn:jboss:module:1.5" name="org.postgresql">
    <resources>
      <resource-root path="postgresql-42.7.7.jar"/>
    </resources>
    <dependencies>
      <module name="javax.api"/>
      <module name="javax.transaction.api"/>
    </dependencies>
  </module>
  ```
- Теперь используем базу данных PostgreSQL с курса программирования прошлого семестра (вы же поднимали её локально там, да?)
- Собираем проект ```mvn clean package```
- Запускаем сервер: ```.\wildfly-20.0.0.Final\bin\standalone.bat```
- Подключаемся к http://localhost:9990
- Открываем вкладку Deployments -> Add -> Select a deployment -> выбираем ```.\target\lab3.war```
- Заходим на http://localhost:8080/lab3

### Для запуска в Docker:
- Собираем Docker образ: ```docker-compose up --build```
- Заходим на http://localhost:8080/lab3

### Для запуска на helios:
- Грузим WildFly на гелиос ```scp -P 2222 wildfly-20.0.0.Final.zip s466217@se.ifmo.ru:/home/studs/s466217/web/lab3/```
- Распаковываем ```unzip wildfly-20.0.0.Final.zip```
- Создаём пользователя для админки: ```sh ./wildfly-20.0.0.Final/bin/add-user.sh```
- Меняем в wildfly-20.0.0.Final\standalone\configuration\standalone.xml все 127.0.0.1 на 0.0.0.0
- Добавляем Datasource для PostgreSQL (см. выше):
    - В секции ```<connection-url>``` указываем URL ```jdbc:postgresql://pg/studs```
    - В секции ```<user-name>``` указываем sXXXXXX
    - В секции ```<password>``` указываем пароль из `.pgpass`
- Меняем в конце файла standalone.xml все порты, кроме последнего на свои
- Указываем другую версию джавы на гелиосе ```JAVA_VERSION=11```
- Увеличиваем MetaspaceSize на гелиосе (без этого также не запустится) `export _JAVA_OPTIONS="-Xmx2G -XX:MaxMetaspaceSize=512m"`
- Запускаем сервер: ```sh ./wildfly-20.0.0.Final/bin/standalone.sh```
- Пробрасываем два порта на гелиос: http и http-management (их мы в standalone.xml указывали)
- Собираем проект: ```mvn clean package```
- Заходим на http://localhost:{http-management}
- Открываем вкладку Deployments -> Add -> Select a deployment -> выбираем ```.\target\lab3.war```
- Заходим на http://localhost:{http}/lab3
- Если вылазит ошибка в логах при отправке точки, то создаём вручную последовательность:
    - `psql -h pg -d studs`
    - `CREATE SEQUENCE points_id_seq START 1 INCREMENT 1;`
