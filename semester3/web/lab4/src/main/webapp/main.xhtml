<!DOCTYPE html>
<html lang="ru">
<head>
    <title>lab3 Main page</title>
</head>
<body>
    <header>
        <h1>Козаченко Данил Александрович</h1>
        <h1>Группа: P3212 Вариант: 466217</h1>
    </header>
    <main>
        <section class="input-section">
            <form id="pointForm">
                <panelGroup layout="block">
                    <outputLabel value="Координата X:" for="x"/>
                    <selectOneMenu id="x" value="#{pointBean.x}">
                        <f:selectItems value="#{pointBean.xValues}" var="val" itemValue="#{val}" itemLabel="#{val}"/>
                    </selectOneMenu>
                </panelGroup>

                <panelGroup layout="block">
                    <outputLabel value="Координата Y:" for="y"/>
                    <inputText id="y" value="#{pointBean.y}" placeholder="-5..5"
                                 onkeypress="return /[0-5.\-]/.test(event.key)">
                        <f:validateDoubleRange minimum="-5" maximum="5"/>
                    </inputText>
                    <message id="yMessage" for="y" styleClass="invalid-input"/>
                </panelGroup>
                <panelGroup layout="block" styleClass="rContainer">
                    <outputLabel value="Радиус района дислокации ВСУ R:" styleClass="rLabel"/>
                    <panelGroup layout="block" styleClass="rButtons">
                        <commandButton value="1"
                                         styleClass="rButton selected"
                                         action="#{pointBean.setR(1)}"
                                         onclick="setRValue(this)">
                            <f:ajax execute="@this"/>
                        </commandButton>
                        <commandButton value="2"
                                         styleClass="rButton"
                                         action="#{pointBean.setR(2)}"
                                         onclick="setRValue(this)">
                            <f:ajax execute="@this"/>
                        </commandButton>
                        <commandButton value="3"
                                         styleClass="rButton"
                                         action="#{pointBean.setR(3)}"
                                         onclick="setRValue(this)">
                            <f:ajax execute="@this"/>
                        </commandButton>
                        <commandButton value="4"
                                         styleClass="rButton"
                                         action="#{pointBean.setR(4)}"
                                         onclick="setRValue(this)">
                            <f:ajax execute="@this"/>
                        </commandButton>
                        <commandButton value="5"
                                         styleClass="rButton"
                                         action="#{pointBean.setR(5)}"
                                         onclick="setRValue(this)">
                            <f:ajax execute="@this"/>
                        </commandButton>
                    </panelGroup>
                </panelGroup>

                <commandButton id="submitButton" value="Бахнуть орешником"
                                 styleClass="submitButton"
                                 action="#{pointBean.submit}">
                    <f:ajax execute="x y" render="resultsTable scriptPanel yMessage"/>
                </commandButton>

                <inputHidden id="clickX" value="#{pointBean.x}"/>
                <inputHidden id="clickY" value="#{pointBean.y}"/>
                <inputHidden id="clickR" value="#{pointBean.r}"/>
                <commandButton id="hiddenSubmit"
                                 style="display:none"
                                 action="#{pointBean.submit}">
                    <f:ajax execute="clickX clickY clickR" render="resultsTable scriptPanel"/>
                </commandButton>
            </form>
        </section>

        <section class="graph-section">
            <h2>Карта боевых действий</h2>
            <div style="position: relative; widt 300px; height: 300px;">
                <canvas id="bgCanvas" width="300" height="300" style="position:absolute; z-index:0;">
                </canvas>
                <canvas id="graphCanvas" width="300" height="300" style="position:absolute; z-index:1;">
                </canvas>
            </div>
            <img src="#{resource['images/boom.gif']}" id="boom-gif"
                 style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;"
                 alt="">
            </img>
            <img src="#{resource['images/miss.gif']}" id="miss-gif"
                 style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;"
                 alt="">
            </img>
        </section>

        <section class="results-section">
            <h2>Результаты</h2>
            <div class="resultsTable">
                <dataTable id="resultsTable" value="#{pointBean.results}" var="p" border="1">
                    <column>
                        <f:facet name="header">X</f:facet>
                        <outputText value="#{p.x}"/>
                    </column>
                    <column>
                        <f:facet name="header">Y</f:facet>
                        <outputText value="#{p.y}"/>
                    </column>
                    <column>
                        <f:facet name="header">R</f:facet>
                        <outputText value="#{p.r}"/>
                    </column>
                    <column>
                        <f:facet name="header">Попадание</f:facet>
                        <outputText value="#{p.hit ? 'Goida' : 'Potuzhno'}"/>
                    </column>
                    <column>
                        <f:facet name="header">Время прилёта</f:facet>
                        <outputText value="#{p.timestamp}">
                            <f:convertDateTime pattern="dd.MM.yyyy Hmm:ss"/>
                        </outputText>
                    </column>
                </dataTable>
            </div>
        </section>
        <panelGroup id="scriptPanel">
            <outputScript>
                window.results = '#{pointBean.resultsAsJson}';
                window.lastHit = '#{pointBean.lastHit}';
                if (typeof drawGraph === 'function') {
                drawGraph();
                }
                if (typeof showGif === 'function') {
                showGif(window.lastHit);
                }
            </outputScript>
        </panelGroup>
    </main>
</body>
</html>